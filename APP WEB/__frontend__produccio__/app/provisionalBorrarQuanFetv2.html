<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!--carrego la api de google-->
    <script src="https://apis.google.com/js/api.js"></script>

    <!--Necessito aquesta línea per fer crides desde localhost:5500 -treballant en local amb vscode- per
    aconsegir que el navegador no bloqueji certs dominis per la política CSP (Content Security Policy 
    o Política de seguretat de contingut) que s'està aplicant per seguretat. El que bloqueja concretament és
    la càrrega d'un script de google des de gstatic.com (la política CSP aplicada era 
    script-src 'unsafe-inline' 'unsafe-eval' blob: data) i la càrrega d'un script des de https://apis.google.com.
    La solució rau en fer EXCEPCIONS a aquestes: -->
    <!-- <meta http-equiv="Content-Security-Policy" content="script-src 'self' https://www.gstatic.com https://apis.google.com 'unsafe-inline';"> -->


    


    <script>

        /*inicialitzo el client*/
        gapi.load('client:auth2', initClient);

        //INICIALITZO EL CLIENT 
        function initClient() {
            gapi.client.init({
                apiKey: '',
                clientId: '246049552174-fqcrsh2uvcpouptn1tij8t7bh686h4ad.apps.googleusercontent.com',
                discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest'],
                scope: 'https://www.googleapis.com/auth/gmail.readonly'
            }).then(() => {
                // Inicia sesión
                gapi.auth2.getAuthInstance().signIn().then(() => {
                    console.log('Usuari Autenticat');
                    llistarCorreus();
                });
            });
        }

        //
        function llistarCorreus() {
            gapi.client.gmail.users.messages.list({
                userId: 'me',
                maxResults: 5
            }).then(function(response) {
                const messages = response.result.messages;
                if (!messages || messages.length === 0) {
                    console.log('No se encontraron mensajes.');
                } else {
                    console.log('Mensajes:', messages);
                }
            });
        }


    </script>
</head>
<body>
    
</body>
</html>